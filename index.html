<html>
   <head>
      <script type="text/javascript" src="./deps/jquery/jquery.js"></script>
      <script type='text/javascript' src='https://www.google.com/jsapi'></script>
      <script type='text/javascript'>
         var example_data = [
                  ['State', 'Product','Popularity'],
                  ['US-NH', 'dog-food', 200],
                  ['US-CA', 'dog-food', 300],
                  ['US-CT', 'dog-food', 400],
                  ['US-OK', 'dog-food', 500],
                  ['US-AZ', 'dog-food', 600],
                  ['US-CO', 'dog-food', 700]
                ];
      
             google.load('visualization', '1', {'packages': ['geomap']});
//             google.setOnLoadCallback(drawMap);

             function parse(text) {
                 var lines = text.split('\n');
                 return lines.map(function(l) {return l.split('\t');});
             }
             
             function unparse(data) {
                 var lines = data.map(function(d) {return d.join('\t');});
                 return lines.join('\n');
             }
             
             function drawMap() {
                var my_data = parse($("#input").val());
                alert(my_data);
                var data = google.visualization.arrayToDataTable(my_data);

                var options = {dataMode: 'regions',
                     region:'US',
                     resolution : 'metros'};
                
                var container = document.getElementById('map_canvas');
                var geomap = new google.visualization.GeoMap(container);
                geomap.draw(data, options);
             };
             
         $(document).ready(function() {
             $("#redraw").click(drawMap);
             $("#input").val(unparse(example_data));
             $("#redraw").click();
         });
      </script>
   </head>
   <body>
      <div id='map_canvas'></div>
      <textarea id="input" cols="60" rows="15"></textarea>
      <button id="redraw">Redraw map</button>
   </body>
</html>
