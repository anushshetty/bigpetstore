<html>
   <head>
      <script type="text/javascript" src="./deps/jquery/jquery.js"></script>
      <script type='text/javascript' src='https://www.google.com/jsapi'></script>
      <script type='text/javascript'>
         var example_data = [
                  ['State', 'Product','Popularity'],
                  ['US-NH', 'cat-food', 200],
                  ['US-CA', 'dog-food', 300],
                  ['US-CT', 'dog-food', 400],
                  ['US-OK', 'dog-food', 500],
                  ['US-AZ', 'dog-food', 600],
                  ['US-CO', 'dog-food', 700]
                ];
      
             google.load(
                'visualization', 
                '1', 
                {
                   'packages': ['geomap']
                }
             );
             //google.setOnLoadCallback(drawMap);

             //take a block of input text, 
             //convert it to json
             function parse(text) {
                 var lines = text.split('\n');
		 var filtered = 
		    lines.filter(
				    function (el) {
		            //only visualize "dog-food" if thats what is entered...		     
			    var t = (el.match(document.getElementById("product").value) != null);
			     return t;
			    }
		 );
	         return filtered.map(
                    function(l) {
                       var array = l.split('\t');
                       return [array[0], array[2]];
                       }
                    );
             }
             
             //Take a json object, 
             //convert it to plain text
             function unparse(data) {
                 var lines = data.map(function(d) {
                    return d.join('\t');
                 });
                 return lines.join('\n');
             }
             
             function drawMap() {
                var my_data = parse($("#input").val());
                //alert("hrt");
                var data = google.visualization.arrayToDataTable(my_data);

                var options = {
                     dataMode: 'regions',
                     region:'US',
                     resolution : 'metros'};
                
                var container = document.getElementById('map_canvas');
                var geomap = new google.visualization.GeoMap(container);
                geomap.draw(data, options);
             };
             
         $(document).ready(function() {
             $("#redraw").click(drawMap);
             $("#input").val(unparse(example_data));
             $("#redraw").click();
         });
      </script>
   </head>
   <body>
      <div id='map_canvas'></div>
      <textarea id="input" cols="60" rows="15"></textarea>
      <button id="redraw">Redraw map</button>
      <h2>Filter product name (i.e. dog-food, cat-food, ...) </h2>
      <input id="product" type='text' name='txt' value="dog-food">

   </body>
</html>

